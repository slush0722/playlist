<!DOCTYPE html>
<html>
<head>
  <meta charset="UTF-8">
  <title>Playlist</title>
  <style>
    @font-face {
      font-family: '여기어때 잘난체 2';
      src: url('fonts/Jalnan2.otf') format('opentype');
    }

    @font-face {
      font-family: 'Maplestory';
      src: url('fonts/Maplestory-Light.ttf') format('truetype');
    }

    body {
      margin: 0;
      padding: 0;
      font-family: 'Maplestory', sans-serif;
      background: url('background.png') no-repeat center center fixed;
      background-size: cover;
      box-sizing: border-box;
    }

    body::before {
      content: "";
      position: fixed;
      top: 0;
      left: 0;
      width: 100%;
      height: 100%;
      border: 20px solid rgba(255, 255, 255, 0.2);
      box-sizing: border-box;
      pointer-events: none;
      z-index: 1;
    }

    .header {
      text-align: center;
      padding: 35px 0 10px;
      z-index: 2;
      position: relative;
    }

    .header h1 {
      font-family: '여기어때 잘난체 2', sans-serif;
      font-size: 40px;
      color: #F1C40F;
      margin: 0;
    }

    .main-container {
      display: flex;
      justify-content: space-between;
      align-items: flex-start;
      padding: 10px 50px; /* 위 패딩 20px → 10px로 줄임 */
      margin-top: -75px;   /* 추가로 약간 위로 당기기 */
      z-index: 2;
      position: relative;
    }

    .icon-column-wrapper {
      border: 4px solid #333333;
      padding: 20px;
      border-radius: 12px;
      background-color: #1f1f1f;
      display: flex;
      flex-direction: column;
      align-items: center;
    }

    .icon-title-bar {
      display: flex;
      align-items: center;
      justify-content: center;
      gap: 20px;
      margin-bottom: 15px;
    }

    .icon-title {
      font-family: '여기어때 잘난체 2', sans-serif;
      font-size: 24px;
      color: #ffffff;
    }

    .arrow-button {
      background: none;
      border: none;
      font-size: 24px;
      color: white;
      cursor: pointer;
      transition: transform 0.2s ease;
    }
    
    .arrow-button:hover {
      transform: scale(1.3);
    }
    
    /* 클릭 또는 키보드 포커스 시에도 테두리 변화 없음 */
    .arrow-button:focus,
    .arrow-button:active {
      outline: none;
      box-shadow: none;
      border: none;
    }

    .icon-item {
      display: flex;
      align-items: center;
      gap: 10px;
      border: 2px solid #333;
      border-radius: 12px;
      background: #1f1f1f;
      padding: 8px 10px;
      width: 100%;
      height: 80px; /* ✅ 높이 고정 */
      box-sizing: border-box;
    }
    
    .playButton {
      width: 60px; /* ✅ 이미지 크기 조정 */
      height: 60px;
      object-fit: cover;
      border-radius: 8px;
      background-color: #555;
      cursor: pointer;
      border: 2px solid #444;
    }

    .playlist-column {
      display: flex;
      flex-direction: column;
      gap: 10px; /* 기존보다 넉넉한 간격으로 증가 */
      transform: translateY(-50px);
    
      border: 4px solid #333333;
      padding: 30px; /* 내부 패딩도 여유 있게 */
      border-radius: 12px;
      background-color: #1f1f1f;
    }    

    iframe {
      border-radius: 12px;
      width: 300px;
      height: 152px;
    }

    .volume-control {
      position: fixed;
      bottom: 20px;
      left: 50%;
      transform: translateX(-50%);
      z-index: 999;
      font-family: 'Maplestory', sans-serif;
      font-weight: bold;
      background-color: rgba(0, 0, 0, 0.7);
      padding: 8px 14px;
      border-radius: 10px;
      color: white; /* 요거 추가 */
    }
    #volumeSlider {
      width: 120px;
    }
    
    .playButton:hover {
      transform: scale(1.1); /* 마우스 올리면 20% 커짐 */
    }
    
    iframe {
      border-radius: 12px;
      width: 300px;
      height: 152px;
      transition: transform 0.2s ease; /* 부드러운 애니메이션 */
    }
    
    iframe:hover {
      transform: scale(1.05); /* 살짝 커짐 */
    }

    #volumeSlider {
      width: 120px;
      transition: transform 0.2s ease;
    }
    
    #volumeSlider:hover {
      transform: scale(1.05);
    }

    /* Playlist 기본 스타일 */
    .header h1 {
      transition: transform 0.3s ease;
      display: inline-block; /* transform 적용을 자연스럽게 만들기 위해 */
    }
    
    .header:hover h1 {
      transform: scale(1.2); /* 원하는 비율로 커지게 조절 */
    }

    .time-box {
      font-family: 'Maplestory', sans-serif;
      font-weight: bold;
      font-size: 24px;
      text-align: center;
      margin-top: 10px;
      color: #ffffff;
      
      max-width: 90%; /* 화면 너무 안 넘치게 제한 */
      width: fit-content; /* 내용에 맞는 너비 */
      height: 40px;
      opacity: 0;
      transform: translateY(-10px);
      transition: opacity 0.5s ease, transform 0.5s ease;
      pointer-events: none;
      display: flex;
      justify-content: center;
      align-items: center;
    
      background-color: rgba(0, 0, 0, 0.6);
      border: 2px solid rgba(255, 255, 255, 0.3);
      border-radius: 12px;
      padding: 0 12px;
    
      margin-left: auto;
      margin-right: auto; /* 중앙 정렬 */
    }
    

    /* 활성화 상태 (시간 표시) */
    .time-box.active {
      opacity: 1;
      transform: translateY(0);
      pointer-events: auto;
    }

    html, body {
      margin: 0;
      padding: 0;
      overflow: hidden; /* 스크롤 완전 제거 */
      height: 100%;
    }

    #time-box {
      position: fixed;
      bottom: 150px; /* volume-control이 bottom: 20px이므로 위로 60px 띄움 */
      left: 50%;
      transform: translateX(-50%);
      z-index: 999;
    
      font-family: 'Maplestory', sans-serif;
      font-weight: bold;
      font-size: 16px;
      text-align: center;
    
      background-color: rgba(0, 0, 0, 0.6);
      border: 2px solid rgba(255, 255, 255, 0.3);
      border-radius: 12px;
      padding: 0 12px;
      height: 40px;
    
      max-width: 90%;
      width: fit-content;
      color: #aaa;
    
      opacity: 0;
      pointer-events: none;
      display: flex;
      justify-content: center;
      align-items: center;
    
      transition: opacity 0.5s ease, transform 0.5s ease;
    }
    
    #time-box.active {
      opacity: 1;
      transform: translate(-50%, 0);
    }
    
    #volumeControl {
      display: flex;
      align-items: center;
      gap: 10px;
      margin-bottom: 20px;
    }
    
    #volumeSlider {
      width: 150px;
    }
    
    .controls {
      display: flex;
      gap: 10px;
      margin-bottom: 20px;
    }

    .audio-controls {
      position: fixed;
      bottom: 80px; /* 볼륨 바보다 위에 위치하도록 조정 */
      left: 50%;
      transform: translateX(-50%);
      display: flex;
      gap: 15px;
      z-index: 1000;
      
      background-color: rgba(0, 0, 0, 0.7);
      padding: 10px 16px;
      border-radius: 12px;
      border: 2px solid rgba(255, 255, 255, 0.3);
    }
    
    .audio-controls button {
      font-size: 20px;
      background: none;
      border: none;
      color: white;
      cursor: pointer;
      transition: transform 0.2s ease;
    }
    
    .audio-controls button:hover {
      transform: scale(1.2);
    }

    .track-info-bar {
      position: fixed;;
      top: 80px;
      left: 50%;
      transform: translateX(-50%);
      background-color: rgba(255, 255, 255, 0.95);
      padding: 12px 24px;
      color: #111;
      font-size: 18px;
      font-weight: bold;
      border-radius: 12px;
      opacity: 0;
      pointer-events: none;
      transition: opacity 0.4s ease, transform 0.4s ease;
      box-shadow: 0 0 15px rgba(0, 0, 0, 0.3);
      z-index: 9999;
    }
    
    .track-info-bar.active {
      opacity: 1;
      pointer-events: auto;
      transform: translateX(-50%) translateY(20px);
    }
    
    .hideable {
      transition: opacity 0.5s ease, transform 0.5s ease;
    }
    
    /* fade 효과 */
    .fade-in {
      opacity: 1;
      transform: translateX(0) translateY(0); /* y축 이동 제거 */
      pointer-events: auto;
      transition: opacity 0.5s ease, transform 0.5s ease;
    }
    
    .fade-out {
      opacity: 0;
      pointer-events: none;
      transform: translateX(0) translateY(0); /* y축 이동 제거 */
      transition: opacity 0.5s ease, transform 0.5s ease;
    }

    /* 완전히 숨김 (애니메이션 후 적용) */
    .hidden {
      display: none !important;
    }

    /* 아이콘 왼쪽으로 사라질 때 */
    .main-container.fade-out {
      transform: translateX(-50px);
    }

    /* 플레이리스트 오른쪽으로 사라질 때 */
    .playlist-column.fade-out {
      transform: translateX(50px);
    }

    /* playlist-column 이동 */
    .playlist-column.fade-out {
      transform: translateX(50px);
    }
    .playlist-column.fade-in {
      transform: translateX(0);
    }

    #rotatingWrapper {
      position: fixed;
      top: 45%;
      left: 50%;
      transform: translate(-50%, -50%);
      width: 200px;
      height: 200px;
      display: none;
      z-index: 9999;
    }
    
    #rotatingIcon {
      width: 100%;
      height: 100%;
      border-radius: 50%;
      box-shadow: 0 0 20px rgba(0, 0, 0, 0.4), inset 0 0 10px rgba(255, 255, 255, 0.2);
      border: 10px solid #111;
      background-color: #222;
      object-fit: cover;
    
      /* 초기에는 transform 없음 */
    }
    
    .rotating {
      animation: spin 5s linear infinite;
      animation-play-state: running;
    }
    
    .paused {
      animation-play-state: paused !important;
    }
    
    @keyframes spin {
      from {
        transform: rotate(0deg);
      }
      to {
        transform: rotate(360deg);
      }
    }

    #rotatingWrapper {
      transition: transform 0.3s ease;
    }
    
    #rotatingWrapper:hover {
      transform: translate(-50%, -50%) scale(1.1);
    }

    /* 재생 중 바 기본 상태 */
    #trackInfoBar {
      position: fixed;
      top: calc(50% + 120px); /* 돌아가는 이미지 아래로 */
      left: 50%;
      transform: translateX(-50%) translateY(-20px);
      background-color: rgba(0, 0, 0, 0.75);
      padding: 10px 20px;
      color: white;
      font-size: 18px;
      border-radius: 8px;
      opacity: 0;
      pointer-events: none;
      transition: opacity 0.3s ease, transform 0.3s ease;
      z-index: 9999;
    }

    /* 활성화 시 나타남 */
    #trackInfoBar.active {
      opacity: 1;
      pointer-events: auto;
      transform: translateX(-50%) translateY(0);
    }

    @keyframes rollIn {
      0% {
        transform: translate(-150%, -45%) rotate(-180deg);
        opacity: 0;
      }
      100% {
        transform: translate(-50%, -45%) rotate(0deg);
        opacity: 1;
      }
    }
    
    #rotatingWrapper.rolling-in {
      animation: rollIn 1.2s ease-out forwards;
    }

    .audio-controls button {
      font-size: 20px;
      background: none;
      border: none;
      color: white;
      cursor: pointer;
      transition: transform 0.2s ease;
      padding: 8px 10px; /* 버튼 크기 살짝 통일 */
    }
    
    .audio-controls button:hover {
      transform: scale(1.2);
    }

    #toggleViewBtn {
      font-size: 20px;
      background: none;
      border: none;
      color: white;
      cursor: pointer;
      transition: transform 0.2s ease;
      padding: 8px 10px; /* 버튼 크기 살짝 통일 */
    }
    
    #toggleViewBtn:hover {
      transform: scale(1.2);
    }

    #bottomLeftContainer {
      position: fixed;
      bottom: 20px;
      left: 20px;
      z-index: 9999;
      display: flex;
      flex-direction: column;
      align-items: center;
    }
    
    #toggleInfoBtn {
      font-size: 24px;
      background-color: rgba(0, 0, 0, 0.6);
      border: 2px solid rgba(255, 255, 255, 0.4);
      border-radius: 8px;
      color: white;
      cursor: pointer;
      padding: 8px 10px;
      transition: transform 0.2s ease; /* ✅ 커지는 애니메이션 유지 */
    }
  
    /* ✅ hover 시 커지기만 하고, 색은 변화 없음 */
    #toggleInfoBtn:hover {
      transform: scale(1.2);
      background-color: rgba(0, 0, 0, 0.6);
      border: 2px solid rgba(255, 255, 255, 0.4);
      color: white;
    }
  
    #siteInfo {
      position: absolute;
      bottom: 50px; /* 🔥 버튼 바로 위에 */
      left: 50%;
      transform: translateX(-50%);
      margin-bottom: 10px;
      padding: 8px 16px;
      background-color: rgba(0, 0, 0, 0.7);
      color: white;
      font-size: 14px;
      border-radius: 8px;
      text-align: center;
      opacity: 0;
      pointer-events: none;
      border: 2px solid rgba(255, 255, 255, 0.4);
      transition: opacity 0.4s ease, transform 0.4s ease;
      display: block; /* ✅ 기본 display는 block으로 수정! */
      z-index: 9999;
    }
  
    /* active일 때는 opacity만 조절 */
    #siteInfo.active {
      opacity: 1;
      pointer-events: auto;
      transform: translate(-50%, 0);
    }

    .icon-item {
      display: flex;
      align-items: center;
      gap: 12px;
      border: 2px solid #333;
      border-radius: 12px;
      background: #1f1f1f;
      padding: 10px;
      margin-bottom: 12px;
      cursor: pointer;
      width: 100%;
      box-sizing: border-box;
    }
    
    .icon-item:hover {
      background: #333333;
    }
    
    .text-info {
      display: flex;
      flex-direction: column;
      justify-content: center;
    }
    
    .song-title {
      font-weight: bold;
      color: #ffffff;
      font-size: 16px;
    }
    
    .song-artist {
      font-weight: normal;
      color: #bbbbbb;
      font-size: 13px;
    }

    .icon-grid {
      display: flex;
      flex-direction: column;
      overflow-y: auto; /* ✅ 세로 스크롤 */
      max-height: 550px; /* ✅ 원하는 높이 제한 */
      padding: 10px;
      width: 280px; /* ✅ 고정 너비 설정 */
      box-sizing: border-box;
    }

  </style>
</head>
<body>

  <meta name="viewport" content="width=device-width, initial-scale=1.0">

  <!-- 제목 영역 -->
  <div class="header">
    <h1 id="playlist-title">Playlist</h1> <!-- 상단 타이틀 텍스트 -->
  </div>

  <div class="hideable">
    <!-- 재생 시간 표시 영역 -->
    <div id="time-box" class="time-box"> </div>
    <div id="clock-box" class="time-box"></div>

    <!-- 전체 메인 컨테이너 -->
    <div class="main-container">

      <div class="icon-column-wrapper">
        <div class="icon-title-bar">
          <button class="arrow-button" id="prevBtn">⬅️</button>
          <div class="icon-title" id="title">인스타 감성</div> <!-- ← 이 부분이 인디음악, 해외팝송 등으로 바뀜 -->
          <button class="arrow-button" id="nextBtn">➡️</button>
        </div>
      
        <div class="icon-grid" id="iconGrid"></div>
      </div>

      <!-- 오른쪽: 고정된 Spotify 플레이리스트 영역 -->
      <div class="playlist-column">
        <!-- 각 iframe은 Spotify에서 공유한 플레이리스트를 삽입 -->
        <iframe src="https://open.spotify.com/embed/playlist/0znvYX1Wd2KeE80lEfgYWU?si=be53610498df4771&utm_source=generator" 
          frameborder="0" allow="autoplay; clipboard-write; encrypted-media; fullscreen; picture-in-picture" 
          loading="lazy"></iframe>

        <iframe src="https://open.spotify.com/embed/playlist/1NpUHfTxcSsdIT1vNyXc1U?si=dedd3882dfd54eca&utm_source=generator" 
          frameborder="0" allow="autoplay; clipboard-write; encrypted-media; fullscreen; picture-in-picture" 
          loading="lazy"></iframe>

        <iframe src="https://open.spotify.com/embed/playlist/3GjnImUmFxBYnWwBho6SE8?si=68e7836172484ff2&utm_source=generator" 
          frameborder="0" allow="autoplay; clipboard-write; encrypted-media; fullscreen; picture-in-picture" 
          loading="lazy"></iframe>

        <iframe src="https://open.spotify.com/embed/playlist/59PXvtjDCzcCndx59QkiSH?si=13fc65aa3ee84e29&utm_source=generator" 
          frameborder="0" allow="autoplay; clipboard-write; encrypted-media; fullscreen; picture-in-picture" 
          loading="lazy"></iframe>
      </div>
    </div>

    <!-- 볼륨 조절 슬라이더 -->
    <div class="volume-control" style="font-family: 'Maplestory', sans-serif; font-weight: bold;">
      🔉 Volume: 
      <input type="range" id="volumeSlider" min="0.01" max="1" step="0.01" value="0.1">
      <!-- 슬라이더를 움직이면 JavaScript에서 볼륨이 조정됨 -->
    </div>

    <!-- 오디오 재생을 위한 audio 요소 (보이지 않음) -->
    <audio id="myAudio"></audio>

    <!-- 곡 이름 표시 바 -->
    <div id="trackInfoBar" class="track-info-bar">재생 중: 없음</div>

    <div class="audio-controls">
      <button id="rewindBtn">⏪</button> <!-- 10초 뒤로 -->
      <button id="playPauseBtn">▶️</button>   <!-- 재생/일시정지 버튼 -->
      <button id="forwardBtn">⏩</button>  <!-- 10초 앞으로 -->
      <button id="stopBtn">⏹️</button>        <!-- 정지 버튼 -->
      <button id="loopBtn">🔁</button>        <!-- 루프 재생 버튼 -->
      <button id="shuffleBtn">🎲</button>     <!-- 셔플 재생 버튼 -->
      <button id="autoShuffleBtn">♾️</button> <!-- 자동 랜덤 재생 -->
      <button id="toggleViewBtn">🟦</button>
    </div>
  </div>

  <!-- 이미지 회전용 구조 -->
  <div id="rotatingWrapper">
    <img id="rotatingIcon" src="" alt="Album Art" />
  </div>

  <!-- 좌측 하단에 화살표 버튼 + 정보 박스 -->
  <div id="bottomLeftContainer" style="position: fixed; bottom: 30px; left: 40px; z-index: 9999;">
    <button id="toggleInfoBtn">⬆️</button>
    <div id="siteInfo">
      Version: 1.2.1<br>
      Visitors: <span id="visitorCount">0</span>
    </div>
  </div>  

  <script>
    
    // HTML 요소들을 가져옴
    const audio = document.getElementById('myAudio');           // 오디오 객체
    const iconGrid = document.getElementById('iconGrid');       // 사운드 버튼 이미지가 들어갈 그리드 영역
    const title = document.getElementById('title');             // 현재 박스의 타이틀 표시 영역
    const volumeSlider = document.getElementById('volumeSlider'); // 볼륨 슬라이더
    const playPauseBtn = document.getElementById('playPauseBtn'); // 재생/일시정지 버튼
    const stopBtn = document.getElementById('stopBtn');           // 정지 버튼
    const loopBtn = document.getElementById('loopBtn');           // 반복재생 버튼
    const shuffleBtn = document.getElementById('shuffleBtn');     // 랜덤재생 버튼
    const timeBox = document.getElementById('time-box');     // 오디오 재생 시간 박스
    const clockBox = document.getElementById('clock-box');   // 현재 시각 박스

    // 초기 볼륨 설정
    audio.volume = parseFloat(volumeSlider.value);

    // 볼륨 슬라이더 변화 감지하여 오디오 볼륨 반영
    volumeSlider.addEventListener('input', () => {
      audio.volume = parseFloat(volumeSlider.value);
    });

    // 현재 박스 인덱스 (처음은 0번)
    let currentIndex = 0;

    // 현재 재생 중인 사운드 인덱스 (-1은 재생 중 아님)
    let currentSoundIndex = -1;

    const data = [
      {
        title: '인스타 감성',
        tracks: [
          { sound: 'sounds/1-1.mp3', image: 'images/1-1.png', title: "Everything", artist: "작곡가1" },
          { sound: 'sounds/1-2.mp3', image: 'images/1-2.png', title: "은방울", artist: "작곡가2" },
          { sound: 'sounds/1-3.mp3', image: 'images/1-3.png', title: "Here with me", artist: "작곡가3" },
          { sound: 'sounds/1-4.mp3', image: 'images/1-4.png', title: "Come back with me", artist: "작곡가4" },
          { sound: 'sounds/1-5.mp3', image: 'images/1-5.png', title: "소나기", artist: "작곡가5" },
          { sound: 'sounds/1-6.mp3', image: 'images/1-6.png', title: "I believe", artist: "작곡가6" },
          { sound: 'sounds/1-7.mp3', image: 'images/1-7.png', title: "Missing", artist: "Unknown" }
        ]
      },
      {
        title: '해외 팝송',
        tracks: [
          { sound: 'sounds/2-1.mp3', image: 'images/2-1.png', title: "Just the two of Us", artist: "작곡가6" },
          { sound: 'sounds/2-2.mp3', image: 'images/2-2.png', title: "Missing", artist: "Unknown" },
          { sound: 'sounds/2-3.mp3', image: 'images/2-3.png', title: "Missing", artist: "Unknown" },
          { sound: 'sounds/2-4.mp3', image: 'images/2-4.png', title: "Missing", artist: "Unknown" },
          { sound: 'sounds/2-5.mp3', image: 'images/2-5.png', title: "Missing", artist: "Unknown" },
          { sound: 'sounds/2-6.mp3', image: 'images/2-6.png', title: "Missing", artist: "Unknown" }
        ]
      },
      {
        title: '신나는 음악',
        tracks: [
          { sound: 'sounds/3-1.mp3', image: 'images/3-1.png', title: "Missing", artist: "Unknown" },
          { sound: 'sounds/3-2.mp3', image: 'images/3-2.png', title: "Missing", artist: "Unknown" },
          { sound: 'sounds/3-3.mp3', image: 'images/3-3.png', title: "Missing", artist: "Unknown" },
          { sound: 'sounds/3-4.mp3', image: 'images/3-4.png', title: "Missing", artist: "Unknown" },
          { sound: 'sounds/3-5.mp3', image: 'images/3-5.png', title: "Missing", artist: "Unknown" },
          { sound: 'sounds/3-6.mp3', image: 'images/3-6.png', title: "Missing", artist: "Unknown" }
        ]
      },
      {
        title: '인디음악',
        tracks: [
          { sound: 'sounds/4-1.mp3', image: 'images/4-1.png', title: "Missing", artist: "Unknown" },
          { sound: 'sounds/4-2.mp3', image: 'images/4-2.png', title: "Missing", artist: "Unknown" },
          { sound: 'sounds/4-3.mp3', image: 'images/4-3.png', title: "Missing", artist: "Unknown" },
          { sound: 'sounds/4-4.mp3', image: 'images/4-4.png', title: "Missing", artist: "Unknown" },
          { sound: 'sounds/4-5.mp3', image: 'images/4-5.png', title: "Missing", artist: "Unknown" },
          { sound: 'sounds/4-6.mp3', image: 'images/4-6.png', title: "Missing", artist: "Unknown" }
        ]
      },
      {
        title: '발라드',
        tracks: [
          { sound: 'sounds/5-1.mp3', image: 'images/5-1.png', title: "Feels", artist: "Unknown" },
          { sound: 'sounds/5-2.mp3', image: 'images/5-2.png', title: "온리원", artist: "Unknown" },
          { sound: 'sounds/5-3.mp3', image: 'images/5-3.png', title: "어땠을까", artist: "Unknown" },
          { sound: 'sounds/5-4.mp3', image: 'images/5-4.png', title: "Galaxy", artist: "Unknown" },
          { sound: 'sounds/5-5.mp3', image: 'images/5-5.png', title: "미치게 해", artist: "Unknown" },
          { sound: 'sounds/5-6.mp3', image: 'images/5-6.png', title: "다라리", artist: "Unknown" }
        ]
      },
      {
        title: '잔잔한 음악',
        tracks: [
          { sound: 'sounds/6-1.mp3', image: 'images/6-1.png', title: "Missing", artist: "Unknown" },
          { sound: 'sounds/6-2.mp3', image: 'images/6-2.png', title: "Missing", artist: "Unknown" },
          { sound: 'sounds/6-3.mp3', image: 'images/6-3.png', title: "Missing", artist: "Unknown" },
          { sound: 'sounds/6-4.mp3', image: 'images/6-4.png', title: "Missing", artist: "Unknown" },
          { sound: 'sounds/6-5.mp3', image: 'images/6-5.png', title: "Missing", artist: "Unknown" },
          { sound: 'sounds/6-6.mp3', image: 'images/6-6.png', title: "Missing", artist: "Unknown" }
        ]
      }
    ];

    // 아이콘 및 타이틀 로드 함수
    function loadBox(index) {
      const box = data[index];
      title.textContent = box.title;
      iconGrid.innerHTML = '';
    
      box.tracks.forEach((track) => {
        const iconWrapper = document.createElement('div');
        iconWrapper.className = 'icon-item';
    
        const img = document.createElement('img');
        img.src = track.image;
        img.onerror = function () {
          img.src = 'images/missing.png';
        };
        img.className = 'playButton';
    
        const textWrapper = document.createElement('div');
        textWrapper.className = 'text-info';
    
        const titleElem = document.createElement('div');
        titleElem.className = 'song-title';
        titleElem.textContent = track.title || "없음";
    
        const artistElem = document.createElement('div');
        artistElem.className = 'song-artist';
        artistElem.textContent = track.artist || "-";
    
        textWrapper.appendChild(titleElem);
        textWrapper.appendChild(artistElem);
    
        iconWrapper.appendChild(img);
        iconWrapper.appendChild(textWrapper);
    
        iconWrapper.addEventListener('click', () => {
          playSound(track.sound);
        });
    
        iconGrid.appendChild(iconWrapper);
      });
    }
    
    loadBox(currentIndex); // 초기 박스 로드

    // 이전 버튼 클릭 시 이전 박스로 이동
    document.getElementById('prevBtn').addEventListener('click', () => {
      currentIndex = (currentIndex - 1 + data.length) % data.length; // 인덱스 감소, 순환
      loadBox(currentIndex);
    });

    // 다음 버튼 클릭 시 다음 박스로 이동
    document.getElementById('nextBtn').addEventListener('click', () => {
      currentIndex = (currentIndex + 1) % data.length; // 인덱스 증가, 순환
      loadBox(currentIndex);
    });
    
    // 전역에서 현재 재생 중인 트랙 경로를 추적
    let currentTrackSrc = null;

    let isStopped = false; // 전역에서 선언 필요!

    stopBtn.addEventListener('click', () => {
      playSound('sounds/missing.mp3');
    
      // 이미지 설정
      rotatingIcon.src = 'images/missing.png';
      rotatingIcon.classList.remove('rotating', 'paused');
      document.getElementById('rotatingWrapper').style.display = 'block';
    
      playPauseBtn.textContent = '⏸️';
    });

    // 재생 버튼 동작
    playPauseBtn.addEventListener('click', () => {
      // ✅ 현재 재생 중인 트랙이 없으면 재생하지 않음
      if (!currentTrackSrc) {
        console.warn('🎵 재생할 트랙이 없습니다.');
        return;
      }

      if (audio.paused) {
        audio.play();
        playPauseBtn.textContent = '⏸️';
        rotatingIcon.classList.remove('paused');
        rotatingIcon.classList.add('rotating');
      } else {
        audio.pause();
        playPauseBtn.textContent = '▶️';
        rotatingIcon.classList.add('paused');
      }
    });
    
    function showMissingIcon() {
      const wrapper = document.getElementById('rotatingWrapper');
      wrapper.style.display = 'block';
    
      rotatingIcon.classList.remove('rotating', 'paused'); // 회전 멈춤
      rotatingIcon.src = 'images/missing.png'; // missing 이미지로 교체
    }

    // 루프 버튼
    loopBtn.addEventListener('click', () => {
      audio.loop = !audio.loop;
      loopBtn.style.color = audio.loop ? 'yellow' : 'white';
      loopBtn.textContent = audio.loop ? '🔂' : '🔁';
    });

    // 셔플 버튼 (수정)
    shuffleBtn.addEventListener('click', () => {
      const validSounds = getValidSoundsInCurrentBox();
      
      if (validSounds.length === 0) {
        console.warn('🎲 셔플 가능한 곡이 없습니다!');
        return;
      }
      
      const randomIndex = Math.floor(Math.random() * validSounds.length);
      const randomSoundPath = validSounds[randomIndex];
      playSound(randomSoundPath);
    });

    // 재생/일시정지 상태 자동 반영
    audio.addEventListener('play', () => {
      playPauseBtn.textContent = '⏸️';
      showRotatingIcon();
    });

    audio.addEventListener('pause', () => {
      if (!audio.ended && audio.currentTime > 0) {
        pauseRotatingIcon(); // 일시정지일 때만 회전 멈추기
      }
    });

    // 오디오 재생 시간 업데이트 함수
    function updateTimeText() {
      const current = formatTime(audio.currentTime);
      const duration = formatTime(audio.duration || 0);
      timeBox.textContent = `${current} / ${duration}`;
    }

    // 날짜 + 시간 표시: MM월 DD일 HH:MM:SS
    function updateClockText() {
      const now = new Date();

      const month = (now.getMonth() + 1).toString().padStart(2, '0'); // getMonth는 0부터 시작
      const date = now.getDate().toString().padStart(2, '0');
      const hour = now.getHours().toString().padStart(2, '0');
      const min = now.getMinutes().toString().padStart(2, '0');
      const sec = now.getSeconds().toString().padStart(2, '0');

      clockBox.textContent = `${month}월 ${date}일 ${hour}:${min}:${sec}`;
    }

    // 현재 시간은 항상 업데이트
    setInterval(updateClockText, 1000);

    // 처음 로드되었을 때도 즉시 보이게
    function showClockBox() {
      clockBox.classList.add('active');
      updateClockText();
    }

    // 오디오 재생 중일 때만 시간 텍스트 갱신
    setInterval(() => {
      if (!audio.paused && !audio.ended) {
        updateTimeText();
      }
    }, 500);

    // 현재 시간은 항상 업데이트
    setInterval(updateClockText, 1000);

    // 오디오 재생 시간 박스 표시
    function updateTimeBox() {
      timeBox.classList.add('active');
      updateTimeText();
    }

    // 현재 시계 박스 표시
    function showClockBox() {
      clockBox.classList.add('active');
      updateClockText();
    }

    // 초기 실행
    updateTimeBox();

    // 시간 형식 함수 (mm:ss)
    function formatTime(seconds) {
      const min = Math.floor(seconds / 60);
      const sec = Math.floor(seconds % 60);
      return `${min}:${sec.toString().padStart(2, '0')}`;
    }

    const playlistTitle = document.getElementById('playlist-title');
    const trackInfoBar = document.getElementById('trackInfoBar');

    // 곡명 바 클릭 시 닫힘
    trackInfoBar.addEventListener('click', () => {
      trackInfoBar.classList.remove('active');
    });

    const trackNames = {
      "1-1.mp3": { title: "Everything", artist: "작곡가1" },
      "1-2.mp3": { title: "은방울", artist: "작곡가2" },
      "1-3.mp3": { title: "Here with me", artist: "작곡가3" },
      "1-4.mp3": { title: "Come back with me", artist: "작곡가4" },
      "1-5.mp3": { title: "소나기", artist: "작곡가5" },
      "1-6.mp3": { title: "I believe", artist: "작곡가6" },
      "1-7.mp3": { title: "Missing", artist: "Unknown" },
      "2-1.mp3": { title: "Just the two of Us", artist: "Unknown" },
      "2-2.mp3": { title: "Missing", artist: "Unknown" },
      "2-3.mp3": { title: "Missing", artist: "Unknown" },
      "2-4.mp3": { title: "Missing", artist: "Unknown" },
      "2-5.mp3": { title: "Missing", artist: "Unknown" },
      "2-6.mp3": { title: "Missing", artist: "Unknown" },
      "3-1.mp3": { title: "Missing", artist: "Unknown" },
      "3-2.mp3": { title: "Missing", artist: "Unknown" },
      "3-3.mp3": { title: "Missing", artist: "Unknown" },
      "3-4.mp3": { title: "Missing", artist: "Unknown" },
      "3-5.mp3": { title: "Missing", artist: "Unknown" },
      "3-6.mp3": { title: "Missing", artist: "Unknown" },
      "4-1.mp3": { title: "Missing", artist: "Unknown" },
      "4-2.mp3": { title: "Missing", artist: "Unknown" },
      "4-3.mp3": { title: "Missing", artist: "Unknown" },
      "4-4.mp3": { title: "Missing", artist: "Unknown" },
      "4-5.mp3": { title: "Missing", artist: "Unknown" },
      "4-6.mp3": { title: "Missing", artist: "Unknown" },
      "5-1.mp3": { title: "Feels", artist: "Unknown" },
      "5-2.mp3": { title: "온리원", artist: "Unknown" },
      "5-3.mp3": { title: "어땠을까", artist: "Unknown" },
      "5-4.mp3": { title: "Galaxy", artist: "Unknown" },
      "5-5.mp3": { title: "미치게 해", artist: "Unknown" },
      "5-6.mp3": { title: "다라리", artist: "Unknown" },
      "6-1.mp3": { title: "Missing", artist: "Unknown" },
      "6-2.mp3": { title: "Missing", artist: "Unknown" },
      "6-3.mp3": { title: "Missing", artist: "Unknown" },
      "6-4.mp3": { title: "Missing", artist: "Unknown" },
      "6-5.mp3": { title: "Missing", artist: "Unknown" },
      "6-6.mp3": { title: "Missing", artist: "Unknown" },
      "missing.mp3": { title: "없음", artist: "-" }
    }; 

    const mainContainer = document.querySelector('.main-container');
    const playlistColumn = document.querySelector('.playlist-column');
    let hidden = false;

    const fadeIn = (element) => {
      const originalDisplay = element.dataset.originalDisplay || getComputedStyle(element).display;
      element.style.display = originalDisplay === 'none' ? 'block' : originalDisplay;
      element.classList.remove('fade-out');
      element.classList.add('fade-in');
    };

    const fadeOut = (element) => {
      element.dataset.originalDisplay = getComputedStyle(element).display;
      element.classList.remove('fade-in');
      element.classList.add('fade-out');
      setTimeout(() => {
        if (element.classList.contains('fade-out')) {
          element.style.display = 'none';
        }
      }, 500);
    };

    // f 키를 눌렀을 때 토글
    document.addEventListener('keydown', (e) => {
      if (e.key.toLowerCase() === 'f') {
        if (!hidden) {
          // 👉 clockBox가 켜져 있었는지 기억해둠
          wasClockVisibleBeforeHide = clockBox.classList.contains('active');
    
          fadeOut(mainContainer);
          fadeOut(playlistColumn);
    
          if (wasClockVisibleBeforeHide) {
            clockBox.classList.remove('active');
          }
    
          hidden = true;
        } else {
          fadeIn(mainContainer);
          fadeIn(playlistColumn);
    
          // 👉 clockBox가 원래 켜져 있었으면 다시 보여줌
          if (wasClockVisibleBeforeHide) {
            clockBox.classList.add('active');
          }
    
          hidden = false;
        }
      }
    });

    // 초기 진입 시 표시
    window.addEventListener('DOMContentLoaded', () => {
      mainContainer.classList.add('fade-in');
      playlistColumn.classList.add('fade-in');
    });

    const rotatingWrapper = document.getElementById('rotatingWrapper');
    const rotatingIcon = document.getElementById('rotatingIcon');

    function showRotatingIcon() {
      rotatingIcon.classList.remove('paused');
      rotatingIcon.classList.add('rotating');
      document.getElementById('rotatingWrapper').style.display = 'block';
    }

    function pauseRotatingIcon() {
      rotatingIcon.classList.add('paused');
    }
    
    function hideRotatingIcon() {
      const wrapper = document.getElementById('rotatingWrapper');
      wrapper.style.display = 'none'; // 아예 숨기기
    
      rotatingIcon.classList.remove('rotating', 'paused');
    }   

    function updateRotatingIcon(source) {
      const fileName = source.split('/').pop().replace('.mp3', '');
      const imagePath = `images/${fileName}.png`;
    
      console.log("🔊 재생된 소스:", source);
      console.log("📁 파싱된 파일명:", fileName);
      console.log("🖼️ 이미지 경로:", imagePath);
    
      rotatingIcon.src = imagePath;
    }

    function playSound(src) {
      const fileName = src.split('/').pop().trim();
      const trackInfo = trackNames[fileName] || { title: "없음", artist: "-" };
      currentTrackSrc = src;
    
      // 1. 🛠️ 트랙 정보 먼저 즉시 반영
      if (trackInfo && trackInfo.title && trackInfo.artist) {
        trackInfoBar.textContent = `${trackInfo.title} - ${trackInfo.artist}`;
      } else {
        trackInfoBar.textContent = "없음";
      }
    
      // 2. 🛠️ 오디오 재생 준비
      audio.pause();
      audio.currentTime = 0;
      audio.src = src;
    
      // 3. 🛠️ 굴러오는 애니메이션 (여기는 그대로 500ms 딜레이)
      rotatingWrapper.classList.remove('rolling-in');
      void rotatingWrapper.offsetWidth; // 강제 리플로우
      rotatingWrapper.classList.add('rolling-in');
    
      updateRotatingIcon(src);
      rotatingWrapper.style.display = 'block';
    
      setTimeout(() => {
        audio.play().catch((err) => {
          console.error("재생 오류:", err);
          trackInfoBar.textContent = "재생 오류 발생"; // 이건 나중에 에러났을 때만 바뀜
        });
    
        updateTimeBox();
        rotatingIcon.classList.remove('paused');
        rotatingIcon.classList.add('rotating');
      }, 500);
    }    

    rotatingIcon.onerror = function () {
      rotatingIcon.src = 'images/missing.png';
    };

    console.log(audio.src);  // 현재 재생 중 파일 전체 경로
    console.log(audio.src.split('/').pop().trim());  // 파일명만 추출

    let autoShuffle = false;

    document.getElementById('autoShuffleBtn').addEventListener('click', () => {
      autoShuffle = !autoShuffle;
    
      const btn = document.getElementById('autoShuffleBtn');
      btn.style.color = autoShuffle ? 'lime' : 'white';
      btn.textContent = autoShuffle ? '✅' : '♾️';
    
      if (autoShuffle) {
        playRandomTrackInCurrentBox();
      }
    });
    
    // 곡 종료 시 자동 재생
    audio.addEventListener('ended', () => {
      if (autoShuffle) {
        playRandomTrackInCurrentBox();
      }
    });
    
    // 현재 박스 안에서 랜덤 재생 가능한 곡 리스트
    function getValidSoundsInCurrentBox() {
      const currentBox = data[currentIndex];
      return currentBox.tracks.map(track => track.sound).filter(sound => {
        const fileName = sound.split('/').pop();
        return trackNames[fileName] && !fileName.includes('missing');
      });
    }

    // 현재 박스 안에서 랜덤 곡 재생
    function playRandomTrackInCurrentBox() {
      const validSounds = getValidSoundsInCurrentBox();
      
      if (validSounds.length === 0) {
        console.warn('재생 가능한 곡이 없습니다!');
        return;
      }
      
      const randomIndex = Math.floor(Math.random() * validSounds.length);
      const randomSoundPath = validSounds[randomIndex];
      playSound(randomSoundPath);
    }

    // 회전 이미지 클릭 시 재생중 바 토글
    rotatingWrapper.addEventListener('click', () => {
      trackInfoBar.classList.toggle('active');
    });

    // 재생중 바 클릭 시 사라지게
    trackInfoBar.addEventListener('click', () => {
      trackInfoBar.classList.remove('active');
    });

    rotatingWrapper.style.display = 'block';
    
    let isClockVisible = false;

    playlistTitle.addEventListener('click', () => {
      if (isClockVisible) {
        clockBox.classList.remove('active');
      } else {
        clockBox.classList.add('active');
      }
      isClockVisible = !isClockVisible;
      wasClockVisibleBeforeHide = isClockVisible; // ✅ 여기 추가 (Playlist 클릭할 때도 동기화)
    });
    
    clockBox.addEventListener('click', () => {
      clockBox.classList.remove('active');
      isClockVisible = false;
      wasClockVisibleBeforeHide = false; // ✅ ClockBox 클릭할 때도 동기화
    });    

    let wasClockVisibleBeforeHide = false;

    const rewindBtn = document.getElementById('rewindBtn');
    const forwardBtn = document.getElementById('forwardBtn');

    // 10초 뒤로 이동
    rewindBtn.addEventListener('click', () => {
      if (!isNaN(audio.duration)) {
        audio.currentTime = Math.max(audio.currentTime - 10, 0);
        updateTimeText();  // 🔥 이동 즉시 시간 업데이트
      }
    });

    // 10초 앞으로 이동
    forwardBtn.addEventListener('click', () => {
      if (!isNaN(audio.duration)) {
        audio.currentTime = Math.min(audio.currentTime + 10, audio.duration);
        updateTimeText();  // 🔥 이동 즉시 시간 업데이트
      }
    });

    const toggleViewBtn = document.getElementById('toggleViewBtn');

    toggleViewBtn.addEventListener('click', () => {
      if (!hidden) {
        fadeOut(mainContainer);
        fadeOut(playlistColumn);
        hidden = true;
      } else {
        fadeIn(mainContainer);
        fadeIn(playlistColumn);
        hidden = false;
      }
    });

    const toggleInfoBtn = document.getElementById('toggleInfoBtn');
    const siteInfo = document.getElementById('siteInfo');

    toggleInfoBtn.addEventListener('click', () => {
      siteInfo.classList.toggle('active');
    });

    // 방문자 수 (임시 증가 기능)
    let visitorCount = parseInt(localStorage.getItem('visitorCount') || '0');
    visitorCount += 1;
    localStorage.setItem('visitorCount', visitorCount);
    document.getElementById('visitorCount').textContent = visitorCount;

  </script>
</body>
</html>
